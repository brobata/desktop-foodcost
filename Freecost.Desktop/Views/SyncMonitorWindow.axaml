<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Freecost.Desktop.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
        x:Class="Freecost.Desktop.Views.SyncMonitorWindow"
        x:DataType="vm:SyncMonitorViewModel"
        Title="Delta Sync Monitor"
        Width="1000" Height="700"
        WindowStartupLocation="CenterOwner"
        Background="#F5F5F5">

	<Grid RowDefinitions="Auto,Auto,*,Auto" Margin="24">

		<!-- Header -->
		<StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,20">
			<TextBlock Text="ðŸ”„ Delta Sync Monitor"
			          FontSize="24"
			          FontWeight="Bold"
			          Foreground="#2D2D2D"/>
			<TextBlock Text="Real-time sync performance and health monitoring"
			          FontSize="14"
			          Foreground="#666"/>
		</StackPanel>

		<!-- Success/Error Messages -->
		<StackPanel Grid.Row="1" Spacing="8" Margin="0,0,0,16">
			<!-- Success Message -->
			<Border Background="#E8F5E9"
			       BorderBrush="#4CAF50"
			       BorderThickness="1"
			       CornerRadius="4"
			       Padding="12"
			       IsVisible="{Binding SuccessMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
				<TextBlock Text="{Binding SuccessMessage}"
				          Foreground="#2E7D32"
				          FontWeight="SemiBold"/>
			</Border>

			<!-- Error Message -->
			<Border Background="#FFEBEE"
			       BorderBrush="#F44336"
			       BorderThickness="1"
			       CornerRadius="4"
			       Padding="12"
			       IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
				<TextBlock Text="{Binding ErrorMessage}"
				          Foreground="#C62828"
				          FontWeight="SemiBold"/>
			</Border>
		</StackPanel>

		<!-- Main Content -->
		<ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
			<StackPanel Spacing="20">

				<!-- Statistics Cards Row -->
				<Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="16">

					<!-- Total Modifications -->
					<Border Grid.Column="0"
					       Background="White"
					       BorderBrush="#D0D0D0"
					       BorderThickness="1"
					       CornerRadius="8"
					       Padding="20">
						<StackPanel Spacing="8">
							<TextBlock Text="ðŸ“Š"
							          FontSize="32"
							          HorizontalAlignment="Center"/>
							<TextBlock Text="{Binding TotalModifications}"
							          FontSize="36"
							          FontWeight="Bold"
							          Foreground="#2196F3"
							          HorizontalAlignment="Center"/>
							<TextBlock Text="Total Modifications"
							          FontSize="13"
							          Foreground="#666"
							          HorizontalAlignment="Center"
							          TextAlignment="Center"/>
						</StackPanel>
					</Border>

					<!-- Unsynced Count -->
					<Border Grid.Column="1"
					       Background="White"
					       BorderBrush="#D0D0D0"
					       BorderThickness="1"
					       CornerRadius="8"
					       Padding="20">
						<StackPanel Spacing="8">
							<TextBlock Text="â³"
							          FontSize="32"
							          HorizontalAlignment="Center"/>
							<TextBlock Text="{Binding UnsyncedCount}"
							          FontSize="36"
							          FontWeight="Bold"
							          Foreground="#FFA726"
							          HorizontalAlignment="Center"/>
							<TextBlock Text="Unsynced"
							          FontSize="13"
							          Foreground="#666"
							          HorizontalAlignment="Center"/>
						</StackPanel>
					</Border>

					<!-- Success Rate -->
					<Border Grid.Column="2"
					       Background="White"
					       BorderBrush="#D0D0D0"
					       BorderThickness="1"
					       CornerRadius="8"
					       Padding="20">
						<StackPanel Spacing="8">
							<TextBlock Text="âœ“"
							          FontSize="32"
							          HorizontalAlignment="Center"/>
							<StackPanel Orientation="Horizontal"
							           HorizontalAlignment="Center"
							           Spacing="4">
								<TextBlock Text="{Binding SuccessRate}"
								          FontSize="36"
								          FontWeight="Bold"
								          Foreground="#66BB6A"/>
								<TextBlock Text="%"
								          FontSize="24"
								          FontWeight="Bold"
								          Foreground="#66BB6A"
								          VerticalAlignment="Center"
								          Margin="0,8,0,0"/>
							</StackPanel>
							<TextBlock Text="Success Rate"
							          FontSize="13"
							          Foreground="#666"
							          HorizontalAlignment="Center"/>
						</StackPanel>
					</Border>

					<!-- API Calls Saved -->
					<Border Grid.Column="3"
					       Background="White"
					       BorderBrush="#D0D0D0"
					       BorderThickness="1"
					       CornerRadius="8"
					       Padding="20">
						<StackPanel Spacing="8">
							<TextBlock Text="ðŸš€"
							          FontSize="32"
							          HorizontalAlignment="Center"/>
							<TextBlock Text="{Binding ApiCallsSavedDisplay}"
							          FontSize="36"
							          FontWeight="Bold"
							          Foreground="#9C27B0"
							          HorizontalAlignment="Center"/>
							<TextBlock Text="API Calls Saved"
							          FontSize="13"
							          Foreground="#666"
							          HorizontalAlignment="Center"
							          TextAlignment="Center"/>
						</StackPanel>
					</Border>
				</Grid>

				<!-- Two Column Layout -->
				<Grid ColumnDefinitions="1.5*,*" ColumnSpacing="20">

					<!-- Left Column -->
					<StackPanel Grid.Column="0" Spacing="20">

						<!-- Modifications by Type -->
						<Border Background="White"
						       BorderBrush="#D0D0D0"
						       BorderThickness="1"
						       CornerRadius="8"
						       Padding="20">
							<StackPanel Spacing="12">
								<TextBlock Text="Modifications by Entity Type"
								          FontSize="16"
								          FontWeight="Bold"
								          Foreground="#2D2D2D"/>

								<Border BorderBrush="#E0E0E0"
								       BorderThickness="1"
								       CornerRadius="4"
								       MinHeight="200">
									<ScrollViewer MaxHeight="300">
										<ItemsControl ItemsSource="{Binding ModificationsByType}">
											<ItemsControl.ItemTemplate>
												<DataTemplate>
													<Border BorderBrush="#F0F0F0"
													       BorderThickness="0,0,0,1"
													       Padding="12">
														<Grid ColumnDefinitions="*,Auto">
															<StackPanel Grid.Column="0" Spacing="4">
																<TextBlock Text="{Binding EntityType}"
																          FontSize="14"
																          FontWeight="SemiBold"/>
																<StackPanel Orientation="Horizontal" Spacing="12">
																	<TextBlock Text="{Binding TotalDisplay}"
																	          FontSize="11"
																	          Foreground="#666"/>
																	<TextBlock Text="{Binding UnsyncedDisplay}"
																	          FontSize="11"
																	          Foreground="#FFA726"/>
																	<TextBlock Text="{Binding FailedDisplay}"
																	          FontSize="11"
																	          Foreground="{Binding StatusColor}"/>
																</StackPanel>
															</StackPanel>
															<Border Grid.Column="1"
															       Width="12"
															       Height="12"
															       CornerRadius="6"
															       Background="{Binding StatusColor}"
															       VerticalAlignment="Center"/>
														</Grid>
													</Border>
												</DataTemplate>
											</ItemsControl.ItemTemplate>
										</ItemsControl>
									</ScrollViewer>
								</Border>
							</StackPanel>
						</Border>

						<!-- Failed Modifications -->
						<Border Background="White"
						       BorderBrush="#D0D0D0"
						       BorderThickness="1"
						       CornerRadius="8"
						       Padding="20">
							<StackPanel Spacing="12">
								<Grid ColumnDefinitions="*,Auto">
									<TextBlock Grid.Column="0"
									          Text="âš ï¸ Failed Modifications"
									          FontSize="16"
									          FontWeight="Bold"
									          Foreground="#2D2D2D"/>
									<Button Grid.Column="1"
									       Command="{Binding RetryFailedCommand}"
									       Content="Retry All"
									       Padding="12,6"
									       Background="#FFA726"
									       Foreground="White"
									       CornerRadius="4"
									       IsEnabled="{Binding FailedCount}"/>
								</Grid>

								<Border BorderBrush="#E0E0E0"
								       BorderThickness="1"
								       CornerRadius="4"
								       MinHeight="200">
									<Grid>
										<!-- Empty State -->
										<StackPanel IsVisible="{Binding !FailedModifications.Count}"
										           VerticalAlignment="Center"
										           Spacing="8"
										           Margin="20">
											<TextBlock Text="âœ“"
											          FontSize="48"
											          Foreground="#66BB6A"
											          HorizontalAlignment="Center"
											          Opacity="0.3"/>
											<TextBlock Text="No failed modifications"
											          FontSize="14"
											          Foreground="#999"
											          HorizontalAlignment="Center"/>
										</StackPanel>

										<!-- Failed Items List -->
										<ScrollViewer MaxHeight="300"
										             IsVisible="{Binding FailedModifications.Count}">
											<ItemsControl ItemsSource="{Binding FailedModifications}">
												<ItemsControl.ItemTemplate>
													<DataTemplate>
														<Border BorderBrush="#F0F0F0"
														       BorderThickness="0,0,0,1"
														       Padding="12"
														       Background="{Binding IsPointerOver, RelativeSource={RelativeSource AncestorType=Border}, Converter={StaticResource BoolToBackgroundConverter}}">
															<StackPanel Spacing="6">
																<Grid ColumnDefinitions="*,Auto">
																	<TextBlock Grid.Column="0"
																	          Text="{Binding EntityTypeDisplay}"
																	          FontSize="13"
																	          FontWeight="SemiBold"/>
																	<Border Grid.Column="1"
																	       Background="#EF5350"
																	       CornerRadius="3"
																	       Padding="6,2">
																		<TextBlock Text="{Binding OperationDisplay}"
																		          FontSize="11"
																		          Foreground="White"/>
																	</Border>
																</Grid>
																<TextBlock Text="{Binding ErrorDisplay}"
																          FontSize="11"
																          Foreground="#C62828"
																          TextWrapping="Wrap"
																          MaxWidth="500"/>
																<TextBlock FontSize="10"
																          Foreground="#999">
																	<Run Text="{Binding AttemptsDisplay}"/>
																	<Run Text="â€¢"/>
																	<Run Text="Last:"/>
																	<Run Text="{Binding LastAttemptDisplay}"/>
																</TextBlock>
															</StackPanel>
														</Border>
													</DataTemplate>
												</ItemsControl.ItemTemplate>
											</ItemsControl>
										</ScrollViewer>
									</Grid>
								</Border>
							</StackPanel>
						</Border>
					</StackPanel>

					<!-- Right Column -->
					<StackPanel Grid.Column="1" Spacing="20">

						<!-- Quick Actions -->
						<Border Background="White"
						       BorderBrush="#D0D0D0"
						       BorderThickness="1"
						       CornerRadius="8"
						       Padding="20">
							<StackPanel Spacing="12">
								<TextBlock Text="Quick Actions"
								          FontSize="16"
								          FontWeight="Bold"
								          Foreground="#2D2D2D"/>

								<Button Command="{Binding TriggerSyncCommand}"
								       Content="â–¶ Trigger Sync Now"
								       HorizontalAlignment="Stretch"
								       Height="40"
								       Background="#4CAF50"
								       Foreground="White"
								       FontWeight="SemiBold"
								       CornerRadius="4"/>

								<Button Command="{Binding LoadStatisticsCommand}"
								       Content="ðŸ”„ Refresh Statistics"
								       HorizontalAlignment="Stretch"
								       Height="40"
								       Background="#2196F3"
								       Foreground="White"
								       FontWeight="SemiBold"
								       CornerRadius="4"/>
							</StackPanel>
						</Border>

						<!-- Recent Sync History -->
						<Border Background="White"
						       BorderBrush="#D0D0D0"
						       BorderThickness="1"
						       CornerRadius="8"
						       Padding="20">
							<StackPanel Spacing="12">
								<TextBlock Text="ðŸ“… Recent Sync History"
								          FontSize="16"
								          FontWeight="Bold"
								          Foreground="#2D2D2D"/>

								<Border BorderBrush="#E0E0E0"
								       BorderThickness="1"
								       CornerRadius="4"
								       MinHeight="150">
									<ScrollViewer MaxHeight="200">
										<ItemsControl ItemsSource="{Binding RecentSyncHistory}">
											<ItemsControl.ItemTemplate>
												<DataTemplate>
													<Border BorderBrush="#F0F0F0"
													       BorderThickness="0,0,0,1"
													       Padding="12,8">
														<Grid ColumnDefinitions="*,Auto">
															<TextBlock Grid.Column="0"
															          Text="{Binding DateDisplay}"
															          FontSize="13"/>
															<TextBlock Grid.Column="1"
															          Text="{Binding ItemsDisplay}"
															          FontSize="12"
															          Foreground="#666"/>
														</Grid>
													</Border>
												</DataTemplate>
											</ItemsControl.ItemTemplate>
										</ItemsControl>
									</ScrollViewer>
								</Border>
							</StackPanel>
						</Border>

						<!-- Cleanup -->
						<Border Background="White"
						       BorderBrush="#D0D0D0"
						       BorderThickness="1"
						       CornerRadius="8"
						       Padding="20">
							<StackPanel Spacing="12">
								<TextBlock Text="ðŸ§¹ Database Cleanup"
								          FontSize="16"
								          FontWeight="Bold"
								          Foreground="#2D2D2D"/>

								<StackPanel Spacing="8">
									<TextBlock FontSize="13"
									          Foreground="#666"
									          TextWrapping="Wrap">
										<Run Text="Remove synced records older than"/>
										<Run Text="{Binding CleanupDays}"/>
										<Run Text="days"/>
									</TextBlock>

									<Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
										<NumericUpDown Grid.Column="0"
										              Value="{Binding CleanupDays}"
										              Minimum="1"
										              Maximum="365"
										              Increment="1"
										              FormatString="0"/>
										<TextBlock Grid.Column="1"
										          Text="days"
										          VerticalAlignment="Center"
										          FontSize="13"
										          Foreground="#666"/>
									</Grid>

									<TextBlock FontSize="12"
									          Foreground="#999">
										<Run Text="{Binding OldSyncedRecordsCount}"/>
										<Run Text="records will be removed"/>
									</TextBlock>

									<Button Command="{Binding CleanupOldRecordsCommand}"
									       Content="Clean Up Now"
									       HorizontalAlignment="Stretch"
									       Height="36"
									       Background="#FF5722"
									       Foreground="White"
									       FontWeight="SemiBold"
									       CornerRadius="4"
									       IsEnabled="{Binding OldSyncedRecordsCount}"/>
								</StackPanel>
							</StackPanel>
						</Border>
					</StackPanel>
				</Grid>
			</StackPanel>
		</ScrollViewer>

		<!-- Footer -->
		<Border Grid.Row="3" Margin="0,16,0,0">
			<Grid ColumnDefinitions="*,Auto">
				<TextBlock Grid.Column="0"
				          VerticalAlignment="Center"
				          Foreground="#666"
				          FontSize="13"
				          Text="Delta sync reduces API calls by ~70%"/>

				<Button Grid.Column="1"
				       Content="Close"
				       Command="{Binding CloseCommand}"
				       Padding="32,10"
				       MinWidth="120"/>
			</Grid>
		</Border>
	</Grid>
</Window>
