<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Freecost.Desktop.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="550"
        x:Class="Freecost.Desktop.Views.PriceHistoryWindow"
        x:DataType="vm:PriceHistoryViewModel"
        Title="Price History"
        Width="700"
        Height="550"
        WindowStartupLocation="CenterOwner"
        CanResize="True"
        Background="#F5F5F5">

	<Grid RowDefinitions="Auto,Auto,*,Auto" Margin="24">

		<!-- Header -->
		<StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,16">
			<TextBlock Text="{Binding IngredientName}"
			          FontSize="24"
			          FontWeight="Bold"
			          Foreground="#2D2D2D"/>
			<TextBlock Text="Price History Tracking"
			          FontSize="14"
			          Foreground="#666"/>
		</StackPanel>

		<!-- Stats Panel -->
		<Border Grid.Row="1"
		        Background="White"
		        CornerRadius="8"
		        Padding="20"
		        Margin="0,0,0,16"
		        BoxShadow="0 2 8 0 #10000000">
			<Grid ColumnDefinitions="*,*,*,*">
				<StackPanel Grid.Column="0" Spacing="6">
					<TextBlock Text="Current" FontSize="12" FontWeight="SemiBold" Foreground="#666"/>
					<TextBlock Text="{Binding CurrentPrice, StringFormat='{}{0:C2}'}" FontSize="22" FontWeight="Bold" Foreground="#2196F3"/>
				</StackPanel>
				<StackPanel Grid.Column="1" Spacing="6">
					<TextBlock Text="Average" FontSize="12" FontWeight="SemiBold" Foreground="#666"/>
					<TextBlock Text="{Binding AveragePrice, StringFormat='{}{0:C2}'}" FontSize="22" FontWeight="Bold" Foreground="#7AB51D"/>
				</StackPanel>
				<StackPanel Grid.Column="2" Spacing="6">
					<TextBlock Text="Highest" FontSize="12" FontWeight="SemiBold" Foreground="#666"/>
					<TextBlock Text="{Binding HighestPrice, StringFormat='{}{0:C2}'}" FontSize="22" FontWeight="Bold" Foreground="#EF5350"/>
				</StackPanel>
				<StackPanel Grid.Column="3" Spacing="6">
					<TextBlock Text="Lowest" FontSize="12" FontWeight="SemiBold" Foreground="#666"/>
					<TextBlock Text="{Binding LowestPrice, StringFormat='{}{0:C2}'}" FontSize="22" FontWeight="Bold" Foreground="#66BB6A"/>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Price History List -->
		<Border Grid.Row="2"
		        Background="White"
		        CornerRadius="8"
		        BoxShadow="0 2 8 0 #10000000"
		        Padding="16">
			<Grid>
				<!-- Loading Spinner -->
				<Border IsVisible="{Binding IsLoading}"
				        Background="#80FFFFFF"
				        ZIndex="100">
					<StackPanel VerticalAlignment="Center"
					           HorizontalAlignment="Center"
					           Spacing="16">
						<TextBlock Text="â³"
						          FontSize="48"
						          HorizontalAlignment="Center"/>
						<TextBlock Text="Loading price history..."
						          FontSize="16"
						          HorizontalAlignment="Center"
						          Foreground="#666"/>
					</StackPanel>
				</Border>

				<!-- Empty State -->
				<StackPanel IsVisible="{Binding !PriceHistory.Count}"
				           VerticalAlignment="Center"
				           HorizontalAlignment="Center"
				           Spacing="16">
					<TextBlock Text="ðŸ“Š"
					          FontSize="64"
					          HorizontalAlignment="Center"/>
					<TextBlock Text="No price history yet"
					          FontSize="20"
					          FontWeight="SemiBold"
					          HorizontalAlignment="Center"
					          Foreground="#2D2D2D"/>
					<TextBlock Text="Price changes will be tracked automatically"
					          FontSize="14"
					          HorizontalAlignment="Center"
					          Foreground="#666"
					          TextAlignment="Center"
					          MaxWidth="300"
					          TextWrapping="Wrap"/>
				</StackPanel>

				<!-- DataGrid -->
				<DataGrid ItemsSource="{Binding PriceHistory}"
				         IsVisible="{Binding PriceHistory.Count}"
				         AutoGenerateColumns="False"
				         IsReadOnly="True"
				         GridLinesVisibility="Horizontal"
				         CanUserResizeColumns="True"
				         CanUserSortColumns="True"
				         SelectionMode="Single">

					<DataGrid.Columns>
						<DataGridTextColumn Header="Date" Binding="{Binding DisplayDate}" Width="2*"/>
						<DataGridTextColumn Header="Price" Binding="{Binding DisplayPrice}" Width="1.5*"/>
						<DataGridTextColumn Header="Type" Binding="{Binding DisplayType}" Width="1.5*"/>
					</DataGrid.Columns>
				</DataGrid>
			</Grid>
		</Border>

		<!-- Close Button -->
		<Button Grid.Row="3"
		        Content="Close"
		        HorizontalAlignment="Right"
		        Margin="0,16,0,0"
		        Padding="32,10"
		        Background="#7AB51D"
		        Foreground="White"
		        CornerRadius="4"
		        FontWeight="SemiBold"
		        Click="OnCloseClicked"/>
	</Grid>
</Window>
