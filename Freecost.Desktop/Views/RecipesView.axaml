<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Freecost.Desktop.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="Freecost.Desktop.Views.RecipesView"
             x:DataType="vm:RecipesViewModel"
             x:Name="RecipesViewControl">

	<Grid RowDefinitions="Auto,Auto,Auto,Auto,*">

		<StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,16">
			<TextBlock Text="Recipes"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="#2D2D2D"/>
			<TextBlock Text="Build recipes from your ingredients"
                       FontSize="14"
                       Foreground="#666"/>
		</StackPanel>

		<!-- Stats Panel -->
		<Border Grid.Row="1"
		        Background="White"
		        CornerRadius="8"
		        Padding="16"
		        Margin="0,0,0,16"
		        BoxShadow="0 2 8 0 #10000000">
			<Grid ColumnDefinitions="*,*,*,*">
				<StackPanel Grid.Column="0" Spacing="4">
					<TextBlock Text="Total" FontSize="12" Foreground="#999"/>
					<TextBlock Text="{Binding TotalRecipes}" FontSize="24" FontWeight="Bold" Foreground="#2D2D2D"/>
				</StackPanel>
				<StackPanel Grid.Column="1" Spacing="4">
					<TextBlock Text="Total Cost" FontSize="12" Foreground="#999"/>
					<TextBlock Text="{Binding TotalCost, StringFormat='{}{0:C2}'}" FontSize="24" FontWeight="Bold" Foreground="#FF9800"/>
				</StackPanel>
				<StackPanel Grid.Column="2" Spacing="4">
					<TextBlock Text="Avg Cost" FontSize="12" Foreground="#999"/>
					<TextBlock Text="{Binding AverageCostPerRecipe, StringFormat='{}{0:C2}'}" FontSize="24" FontWeight="Bold" Foreground="#2196F3"/>
				</StackPanel>
				<StackPanel Grid.Column="3" Spacing="4">
					<TextBlock Text="Categories" FontSize="12" Foreground="#999"/>
					<TextBlock Text="{Binding UniqueCategories}" FontSize="24" FontWeight="Bold" Foreground="#9C27B0"/>
				</StackPanel>
			</Grid>
		</Border>

		<Border Grid.Row="2"
                Background="White"
                CornerRadius="8"
                Padding="16"
                Margin="0,0,0,16"
                BoxShadow="0 2 8 0 #10000000">
			<Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
				<ComboBox Grid.Column="0"
				         ItemsSource="{Binding QuickFilterOptions}"
				         SelectedItem="{Binding SelectedQuickFilter}"
				         MinWidth="140"
				         VerticalAlignment="Center"
				         ToolTip.Tip="Quick filters">
					<ComboBox.ItemTemplate>
						<DataTemplate>
							<TextBlock Text="{Binding}" FontSize="12"/>
						</DataTemplate>
					</ComboBox.ItemTemplate>
				</ComboBox>
				<TextBox Grid.Column="1"
                         Text="{Binding SearchText}"
                         Watermark="Search recipes..."
                         MinWidth="300"
                         VerticalAlignment="Center"/>
				<StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            Spacing="8">
					<!-- Batch Operations Panel -->
					<Border IsVisible="{Binding SelectedRecipes.Count}"
					        Background="#FFF3E0"
					        CornerRadius="4"
					        Padding="12,8"
					        Margin="0,0,8,0">
						<StackPanel Orientation="Horizontal" Spacing="8">
							<TextBlock Text="{Binding SelectedRecipes.Count, StringFormat='{}{0} selected'}"
							          FontWeight="SemiBold"
							          VerticalAlignment="Center"
							          Foreground="#E65100"/>
							<Button Content="âœ“ All"
							        Command="{Binding SelectAllCommand}"
							        Background="#FFB74D"
							        Foreground="White"
							        Padding="8,4"
							        CornerRadius="3"
							        FontSize="11"/>
							<Button Content="âœ• Clear"
							        Command="{Binding ClearSelectionCommand}"
							        Background="#90A4AE"
							        Foreground="White"
							        Padding="8,4"
							        CornerRadius="3"
							        FontSize="11"/>
							<Button Content="ðŸ“‹ Duplicate"
							        Command="{Binding BatchDuplicateCommand}"
							        Background="#64B5F6"
							        Foreground="White"
							        Padding="8,4"
							        CornerRadius="3"
							        FontSize="11"/>
							<Button Content="ðŸ“„ Batch PDF"
							        Command="{Binding GenerateBatchPdfsCommand}"
							        Background="#FF6F00"
							        Foreground="White"
							        Padding="8,4"
							        CornerRadius="3"
							        FontSize="11"
							        ToolTip.Tip="Generate recipe card PDFs for all selected recipes"/>
							<Button Content="ðŸ—‘ï¸ Delete"
							        Command="{Binding BatchDeleteCommand}"
							        Background="#EF5350"
							        Foreground="White"
							        Padding="8,4"
							        CornerRadius="3"
							        FontSize="11"/>
						</StackPanel>
					</Border>
					<Button Content="ðŸ” Filters"
                            Background="#B39DDB"
                            Foreground="White"
                            Padding="16,8"
                            CornerRadius="4"
                            FontWeight="SemiBold">
						<Button.Flyout>
							<Flyout Placement="Bottom">
								<ScrollViewer MaxHeight="500" VerticalScrollBarVisibility="Auto">
									<StackPanel Width="300" Spacing="12">
										<!-- Difficulty Filter -->
										<StackPanel Spacing="8">
											<TextBlock Text="Difficulty Level"
											          FontWeight="Bold"
											          FontSize="14"
											          Foreground="#2D2D2D"/>
											<ComboBox ItemsSource="{Binding DifficultyFilterOptions}"
											         SelectedItem="{Binding SelectedDifficultyFilter}"
											         HorizontalAlignment="Stretch"
											         FontSize="12"/>
										</StackPanel>

										<Separator Height="1" Background="#E0E0E0"/>

										<!-- Category Filter -->
										<StackPanel Spacing="8">
											<TextBlock Text="Category"
											          FontWeight="Bold"
											          FontSize="14"
											          Foreground="#2D2D2D"/>
											<TextBox Text="{Binding CategoryFilter}"
											        Watermark="Filter by category..."
											        FontSize="12"/>
										</StackPanel>

										<Separator Height="1" Background="#E0E0E0"/>

										<!-- Tags Filter -->
										<StackPanel Spacing="8">
											<TextBlock Text="Tags"
											          FontWeight="Bold"
											          FontSize="14"
											          Foreground="#2D2D2D"/>
											<TextBox Text="{Binding TagsFilter}"
											        Watermark="breakfast, quick, etc..."
											        FontSize="12"/>
										</StackPanel>

										<Separator Height="1" Background="#E0E0E0"/>

										<!-- Dietary Labels Filter -->
										<StackPanel Spacing="8">
											<TextBlock Text="Dietary Labels"
											          FontWeight="Bold"
											          FontSize="14"
											          Foreground="#2D2D2D"/>
											<TextBox Text="{Binding DietaryLabelsFilter}"
											        Watermark="vegan, gluten-free, etc..."
											        FontSize="12"/>
										</StackPanel>

										<Separator Height="1" Background="#E0E0E0"/>

										<!-- Allergen Filter -->
										<StackPanel Spacing="8">
											<TextBlock Text="Filter by Allergen"
											          FontWeight="Bold"
											          FontSize="14"
											          Foreground="#2D2D2D"/>
											<ScrollViewer MaxHeight="200"
											             HorizontalScrollBarVisibility="Disabled"
											             VerticalScrollBarVisibility="Auto">
												<ItemsControl ItemsSource="{Binding AvailableAllergens}">
													<ItemsControl.ItemTemplate>
														<DataTemplate>
															<CheckBox Content="{Binding Name}"
															         IsChecked="{Binding IsSelected}"
															         Margin="0,0,0,8"
															         FontSize="12"/>
														</DataTemplate>
													</ItemsControl.ItemTemplate>
												</ItemsControl>
											</ScrollViewer>
										</StackPanel>

										<Button Content="Clear All Filters"
										       Command="{Binding ClearAllFiltersCommand}"
										       Background="#EF9A9A"
										       Foreground="White"
										       Padding="12,6"
										       CornerRadius="4"
										       HorizontalAlignment="Stretch"
										       FontWeight="SemiBold"/>
									</StackPanel>
								</ScrollViewer>
							</Flyout>
						</Button.Flyout>
					</Button>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Action Buttons Row -->
		<Border Grid.Row="3"
		        Background="White"
		        CornerRadius="8"
		        Padding="16"
		        Margin="0,0,0,16"
		        BoxShadow="0 2 8 0 #10000000">
			<StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Left">
				<Button Content="âž• Add Recipe"
				        Command="{Binding AddRecipeCommand}"
				        Background="#7AB51D"
				        Foreground="White"
				        Padding="16,8"
				        CornerRadius="4"
				        FontWeight="SemiBold"/>
				<Button Content="ðŸŒ Import from URL"
				        Command="{Binding ImportFromUrlCommand}"
				        Background="#9C27B0"
				        Foreground="White"
				        Padding="16,8"
				        CornerRadius="4"
				        FontWeight="SemiBold"
				        ToolTip.Tip="Import recipe from cooking website"
				        IsVisible="{Binding IsAuthenticated}"/>
				<Button Content="ðŸ“‹ Import Recipe Cards"
				        Command="{Binding ImportRecipeCardsCommand}"
				        Background="#FF6F00"
				        Foreground="White"
				        Padding="16,8"
				        CornerRadius="4"
				        FontWeight="SemiBold"
				        ToolTip.Tip="Import recipe cards from Excel (multi-tab workbook - requires login)"
				        IsVisible="{Binding IsAuthenticated}"/>
			</StackPanel>
		</Border>

		<Border Grid.Row="4"
                Background="White"
                CornerRadius="8"
                BoxShadow="0 2 8 0 #10000000"
                Padding="16">
			<Grid>
				<!-- Loading Spinner -->
				<Border IsVisible="{Binding IsLoading}"
				        Background="#80FFFFFF"
				        ZIndex="100">
					<StackPanel VerticalAlignment="Center"
					           HorizontalAlignment="Center"
					           Spacing="16">
						<TextBlock Text="â³"
						          FontSize="48"
						          HorizontalAlignment="Center"/>
						<TextBlock Text="Loading recipes..."
						          FontSize="16"
						          HorizontalAlignment="Center"
						          Foreground="#666"/>
					</StackPanel>
				</Border>

				<!-- DataGrid -->
				<DataGrid Name="RecipesDataGrid"
				         ItemsSource="{Binding Recipes}"
				         IsVisible="{Binding Recipes.Count}"
				         SelectedItem="{Binding SelectedRecipe}"
				         AutoGenerateColumns="False"
				         IsReadOnly="True"
				         GridLinesVisibility="Horizontal"
				         CanUserResizeColumns="True"
				         CanUserSortColumns="True"
				         SelectionMode="Extended"
				         SelectionChanged="OnSelectionChanged"
				         DoubleTapped="OnRecipeDoubleTapped"
				         KeyDown="OnKeyDown">


					<DataGrid.ContextMenu>
						<ContextMenu>
							<MenuItem Header="ðŸ“Š View Cost History" Click="OnViewCostHistory"/>
							<MenuItem Header="ðŸ¥§ Cost Breakdown" Click="OnViewCostBreakdown"/>
							<Separator/>
							<MenuItem Header="âœï¸ Edit Recipe" Click="OnEditRecipe"/>
							<MenuItem Header="ðŸ“‹ Duplicate Recipe" Click="OnDuplicateRecipe"/>
							<MenuItem Header="ðŸ–¨ï¸ Print Recipe Card" Click="OnPrintRecipe"/>
							<Separator/>
							<MenuItem Header="ðŸ—‘ï¸ Delete Recipe" Click="OnDeleteRecipe"/>
						</ContextMenu>
					</DataGrid.ContextMenu>

					<DataGrid.Columns>
						<DataGridTemplateColumn Header="Status" Width="60" IsReadOnly="True">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding StatusIcon}"
											  FontSize="18"
											  VerticalAlignment="Center"
											  HorizontalAlignment="Center"
											  Foreground="{Binding StatusColor}"
											  ToolTip.Tip="{Binding StatusTooltip}"/>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>

						<DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="5*"/>
						<DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="1.2*"/>
						<DataGridTextColumn Header="Yield" Binding="{Binding YieldDisplay}" Width="1*"/>
						<DataGridTextColumn Header="Ingredients" Binding="{Binding IngredientCount}" Width="0.8*"/>
						<DataGridTextColumn Header="Total Cost" Binding="{Binding TotalCost}" Width="0.9*"/>
						<DataGridTextColumn Header="Cost/Unit" Binding="{Binding CostPerUnit}" Width="0.9*"/>

						<DataGridTemplateColumn Header="Actions" Width="180" IsReadOnly="True">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal" Spacing="4" Margin="8,0,24,0" VerticalAlignment="Center">
										<Button Content="âœï¸"
												Command="{Binding #RecipesViewControl.DataContext.EditRecipeCommand}"
												CommandParameter="{Binding Recipe}"
												Background="Transparent"
												BorderThickness="0"
												ToolTip.Tip="Edit recipe">
											<Button.Styles>
												<Style Selector="Button:pointerover">
													<Setter Property="Background" Value="#E8F5E9"/>
												</Style>
											</Button.Styles>
										</Button>
										<Button Content="ðŸ“‹"
												Command="{Binding #RecipesViewControl.DataContext.DuplicateRecipeCommand}"
												CommandParameter="{Binding Recipe}"
												Background="Transparent"
												BorderThickness="0"
												ToolTip.Tip="Duplicate recipe">
											<Button.Styles>
												<Style Selector="Button:pointerover">
													<Setter Property="Background" Value="#E3F2FD"/>
												</Style>
											</Button.Styles>
										</Button>
										<Button Content="ðŸ“Š"
												Command="{Binding #RecipesViewControl.DataContext.OpenCostAnalysisCommand}"
												CommandParameter="{Binding Recipe}"
												Background="Transparent"
												BorderThickness="0"
												ToolTip.Tip="Cost analysis">
											<Button.Styles>
												<Style Selector="Button:pointerover">
													<Setter Property="Background" Value="#FFF9C4"/>
												</Style>
											</Button.Styles>
										</Button>
										<Button Content="ðŸ—‘ï¸"
												Command="{Binding #RecipesViewControl.DataContext.DeleteRecipeCommand}"
												CommandParameter="{Binding Recipe}"
												Background="Transparent"
												BorderThickness="0"
												ToolTip.Tip="Delete recipe">
											<Button.Styles>
												<Style Selector="Button:pointerover">
													<Setter Property="Background" Value="#FFEBEE"/>
												</Style>
											</Button.Styles>
										</Button>
									</StackPanel>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>
					</DataGrid.Columns>
				</DataGrid>

				<!-- Empty State -->
				<StackPanel IsVisible="{Binding !Recipes.Count}"
				           VerticalAlignment="Center"
				           HorizontalAlignment="Center"
				           Spacing="16"
				           Margin="0,80,0,0">
					<TextBlock Text="ðŸ“–"
					          FontSize="64"
					          HorizontalAlignment="Center"
					          Opacity="0.3"/>
					<TextBlock Text="No recipes yet"
					          FontSize="20"
					          FontWeight="SemiBold"
					          HorizontalAlignment="Center"
					          Foreground="#999"/>
					<TextBlock Text="Create your first recipe to start tracking costs"
					          FontSize="14"
					          HorizontalAlignment="Center"
					          Foreground="#AAA"
					          TextWrapping="Wrap"
					          TextAlignment="Center"
					          MaxWidth="300"/>
					<Button Content="âž• Create Your First Recipe"
					       Command="{Binding AddRecipeCommand}"
					       Background="#7AB51D"
					       Foreground="White"
					       Padding="16,10"
					       CornerRadius="6"
					       FontWeight="SemiBold"
					       HorizontalAlignment="Center"
					       Margin="0,8,0,0"/>
				</StackPanel>
			</Grid>
		</Border>
	</Grid>
</UserControl>
