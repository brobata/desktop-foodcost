<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Dfc.Desktop.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1100" d:DesignHeight="750"
        x:Class="Dfc.Desktop.Views.ApprovalWorkflowsWindow"
        x:DataType="vm:ApprovalWorkflowsViewModel"
        Title="Approval Workflows"
        Width="1100" Height="750"
        WindowStartupLocation="CenterOwner"
        Background="#F5F5F5">

	<Grid RowDefinitions="Auto,Auto,*,Auto,Auto" Margin="24">

		<!-- Header -->
		<StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,20">
			<TextBlock Text="Approval Workflows"
			          FontSize="24"
			          FontWeight="Bold"
			          Foreground="#2D2D2D"/>
			<TextBlock Text="Review and manage pending approvals"
			          FontSize="14"
			          Foreground="#666"/>
		</StackPanel>

		<!-- Filters -->
		<Border Grid.Row="1"
		       Background="White"
		       BorderBrush="#D0D0D0"
		       BorderThickness="1"
		       CornerRadius="6"
		       Padding="16"
		       Margin="0,0,0,16">
			<Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="12">
				<!-- Status Filter -->
				<StackPanel Grid.Column="0" Spacing="4">
					<TextBlock Text="Status" FontSize="12" Foreground="#666"/>
					<ComboBox ItemsSource="{Binding StatusFilterOptions}"
					         SelectedItem="{Binding FilterStatus}"
					         Width="150"
					         Height="36"/>
				</StackPanel>

				<!-- Show My Submissions -->
				<CheckBox Grid.Column="2"
				         IsChecked="{Binding ShowMySubmissions}"
				         Content="Show My Submissions Only"
				         VerticalAlignment="Bottom"
				         Margin="0,0,0,8"/>

				<!-- Refresh Button -->
				<Button Grid.Column="3"
				       Command="{Binding RefreshWorkflowsCommand}"
				       Content="ðŸ”„ Refresh"
				       Height="36"
				       Padding="16,0"
				       VerticalAlignment="Bottom"
				       Margin="0,0,0,0"/>
			</Grid>
		</Border>

		<!-- Success/Error Messages -->
		<StackPanel Grid.Row="2" Spacing="8" Margin="0,0,0,12">
			<!-- Success Message -->
			<Border Background="#E8F5E9"
			       BorderBrush="#4CAF50"
			       BorderThickness="1"
			       CornerRadius="4"
			       Padding="12"
			       IsVisible="{Binding SuccessMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
				<TextBlock Text="{Binding SuccessMessage}"
				          Foreground="#2E7D32"
				          FontWeight="SemiBold"/>
			</Border>

			<!-- Error Message -->
			<Border Background="#FFEBEE"
			       BorderBrush="#F44336"
			       BorderThickness="1"
			       CornerRadius="4"
			       Padding="12"
			       IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
				<TextBlock Text="{Binding ErrorMessage}"
				          Foreground="#C62828"
				          FontWeight="SemiBold"/>
			</Border>
		</StackPanel>

		<!-- Workflows List -->
		<Border Grid.Row="2"
		       Background="White"
		       BorderBrush="#D0D0D0"
		       BorderThickness="1"
		       CornerRadius="6">
			<Grid RowDefinitions="*,Auto">
				<!-- Empty State -->
				<StackPanel Grid.Row="0"
				           IsVisible="{Binding !Workflows.Count}"
				           VerticalAlignment="Center"
				           HorizontalAlignment="Center"
				           Spacing="12">
					<TextBlock Text="âœ…" FontSize="48" HorizontalAlignment="Center" Opacity="0.3"/>
					<TextBlock Text="No workflows found"
					          FontSize="18"
					          Foreground="#999"
					          HorizontalAlignment="Center"/>
					<TextBlock Text="All approvals are up to date"
					          FontSize="13"
					          Foreground="#BBB"
					          HorizontalAlignment="Center"/>
				</StackPanel>

				<!-- Data Grid -->
				<DataGrid Grid.Row="0"
				         ItemsSource="{Binding Workflows}"
				         SelectedItem="{Binding SelectedWorkflow}"
				         IsVisible="{Binding Workflows.Count}"
				         AutoGenerateColumns="False"
				         GridLinesVisibility="Horizontal"
				         CanUserResizeColumns="True"
				         HeadersVisibility="Column"
				         IsReadOnly="True">
					<DataGrid.Columns>
						<!-- Entity Type -->
						<DataGridTextColumn Header="Type"
						                   Binding="{Binding EntityType}"
						                   Width="1*"/>

						<!-- Entity Name -->
						<DataGridTextColumn Header="Item"
						                   Binding="{Binding EntityName}"
						                   Width="2.5*"/>

						<!-- Status -->
						<DataGridTemplateColumn Header="Status" Width="1.2*">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<Border Background="{Binding StatusColor}"
									       Padding="8,4"
									       CornerRadius="4">
										<TextBlock Text="{Binding Status}"
										          Foreground="{Binding StatusTextColor}"
										          FontWeight="SemiBold"
										          FontSize="11"
										          HorizontalAlignment="Center"/>
									</Border>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>

						<!-- Priority -->
						<DataGridTemplateColumn Header="Priority" Width="1*">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<Border Background="{Binding PriorityColor}"
									       Padding="6,4"
									       CornerRadius="4">
										<TextBlock Text="{Binding Priority}"
										          FontSize="11"
										          HorizontalAlignment="Center"/>
									</Border>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>

						<!-- Submitted By -->
						<DataGridTextColumn Header="Submitted By"
						                   Binding="{Binding SubmittedBy}"
						                   Width="1.8*"/>

						<!-- Submitted At -->
						<DataGridTextColumn Header="Submitted"
						                   Binding="{Binding SubmittedAt}"
						                   Width="1.5*"/>

						<!-- Actions -->
						<DataGridTemplateColumn Header="Actions" Width="2*">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal" Spacing="6">
										<!-- Approve -->
										<Button Content="âœ“"
										       Command="{Binding $parent[DataGrid].((vm:ApprovalWorkflowsViewModel)DataContext).ApproveWorkflowCommand}"
										       CommandParameter="{Binding}"
										       Padding="8,4"
										       FontSize="11"
										       Background="#E8F5E9"
										       ToolTip.Tip="Approve"/>

										<!-- Reject -->
										<Button Content="âœ—"
										       Command="{Binding $parent[DataGrid].((vm:ApprovalWorkflowsViewModel)DataContext).RejectWorkflowCommand}"
										       CommandParameter="{Binding}"
										       Padding="8,4"
										       FontSize="11"
										       Background="#FFEBEE"
										       ToolTip.Tip="Reject"/>

										<!-- Request Revision -->
										<Button Content="â†»"
										       Command="{Binding $parent[DataGrid].((vm:ApprovalWorkflowsViewModel)DataContext).RequestRevisionCommand}"
										       CommandParameter="{Binding}"
										       Padding="8,4"
										       FontSize="11"
										       Background="#FFF3E0"
										       ToolTip.Tip="Request Revision"/>

										<!-- Cancel -->
										<Button Content="âŠ—"
										       Command="{Binding $parent[DataGrid].((vm:ApprovalWorkflowsViewModel)DataContext).CancelWorkflowCommand}"
										       CommandParameter="{Binding}"
										       Padding="8,4"
										       FontSize="11"
										       Background="#F5F5F5"
										       ToolTip.Tip="Cancel"/>
									</StackPanel>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>
					</DataGrid.Columns>
				</DataGrid>
			</Grid>
		</Border>

		<!-- Review Notes Panel -->
		<Border Grid.Row="3"
		       Background="White"
		       BorderBrush="#D0D0D0"
		       BorderThickness="1"
		       CornerRadius="6"
		       Padding="16"
		       Margin="0,16,0,0">
			<StackPanel Spacing="8">
				<TextBlock Text="Review Notes (optional for Approve/Reject, required for Request Revision)"
				          FontSize="13"
				          FontWeight="SemiBold"
				          Foreground="#2D2D2D"/>
				<TextBox Text="{Binding ReviewNotes}"
				        Watermark="Enter your review notes or feedback..."
				        Height="80"
				        AcceptsReturn="True"
				        TextWrapping="Wrap"/>
			</StackPanel>
		</Border>

		<!-- Footer -->
		<Border Grid.Row="4" Margin="0,16,0,0">
			<Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
				<TextBlock Grid.Column="0"
				          VerticalAlignment="Center"
				          Foreground="#666"
				          FontSize="13">
					<Run Text="{Binding Workflows.Count}"/>
					<Run Text="workflow(s)"/>
				</TextBlock>

				<Button Grid.Column="1"
				       Content="Close"
				       Command="{Binding CloseCommand}"
				       Padding="32,10"
				       MinWidth="120"/>
			</Grid>
		</Border>
	</Grid>
</Window>
