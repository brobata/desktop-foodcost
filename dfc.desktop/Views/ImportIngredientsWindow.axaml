<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Dfc.Desktop.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
        x:Class="Dfc.Desktop.Views.ImportIngredientsWindow"
        x:DataType="vm:ImportIngredientsViewModel"
        Title="Import Ingredients from Excel"
        Width="800" Height="600"
        WindowStartupLocation="CenterOwner"
        Background="White">

	<Grid RowDefinitions="Auto,*,Auto" Margin="24">

		<!-- Header -->
		<StackPanel Grid.Row="0" Spacing="12" Margin="0,0,0,20">
			<TextBlock Text="Import Ingredients from Excel"
			          FontSize="20"
			          FontWeight="Bold"
			          Foreground="#2D2D2D"/>
			<TextBlock Text="Select an Excel file with columns: Name, Price, Unit (required). Optional: Vendor, SKU, Category"
			          FontSize="13"
			          Foreground="#666"
			          TextWrapping="Wrap"/>

			<!-- File Selection -->
			<Border BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="4" Padding="12" Background="#F9F9F9">
				<Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
					<TextBlock Grid.Column="0" Text="ðŸ“" FontSize="20" VerticalAlignment="Center"/>
					<TextBlock Grid.Column="1"
					          Text="{Binding SelectedFilePath, FallbackValue='No file selected'}"
					          VerticalAlignment="Center"
					          TextTrimming="CharacterEllipsis"/>
					<Button Grid.Column="2"
					       Content="Browse..."
					       Command="{Binding BrowseFileCommand}"
					       Padding="20,8"/>
				</Grid>
			</Border>

			<!-- Status Message -->
			<Border Background="#E3F2FD"
			       BorderBrush="#2196F3"
			       BorderThickness="1"
			       CornerRadius="4"
			       Padding="12"
			       IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
				<TextBlock Text="{Binding StatusMessage}"
				          Foreground="#1565C0"
				          TextWrapping="Wrap"/>
			</Border>

			<!-- Error Message -->
			<Border Background="#FFEBEE"
			       BorderBrush="#F44336"
			       BorderThickness="1"
			       CornerRadius="4"
			       Padding="12"
			       IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
				<StackPanel Spacing="8">
					<TextBlock Text="{Binding ErrorMessage}"
					          Foreground="#C62828"
					          FontWeight="SemiBold"
					          TextWrapping="Wrap"/>
					<ItemsControl ItemsSource="{Binding Errors}" IsVisible="{Binding Errors.Count}">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<TextBlock Text="{Binding}"
								          Foreground="#D32F2F"
								          FontSize="11"
								          Margin="0,2"/>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</StackPanel>
			</Border>
		</StackPanel>

		<!-- Preview Grid -->
		<Border Grid.Row="1"
		       BorderBrush="#D0D0D0"
		       BorderThickness="1"
		       CornerRadius="4"
		       Background="White">
			<Grid>
				<!-- Empty State -->
				<StackPanel IsVisible="{Binding !PreviewIngredients.Count}"
				           VerticalAlignment="Center"
				           HorizontalAlignment="Center"
				           Spacing="12">
					<TextBlock Text="ðŸ“‹" FontSize="48" HorizontalAlignment="Center" Opacity="0.3"/>
					<TextBlock Text="No ingredients loaded"
					          FontSize="16"
					          Foreground="#999"
					          HorizontalAlignment="Center"/>
					<TextBlock Text="Select an Excel file to preview ingredients"
					          FontSize="13"
					          Foreground="#BBB"
					          HorizontalAlignment="Center"/>
				</StackPanel>

				<!-- Data Grid -->
				<DataGrid ItemsSource="{Binding PreviewIngredients}"
				         IsVisible="{Binding PreviewIngredients.Count}"
				         AutoGenerateColumns="False"
				         IsReadOnly="True"
				         GridLinesVisibility="Horizontal"
				         CanUserResizeColumns="True"
				         HeadersVisibility="Column">
					<DataGrid.Columns>
						<DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="2*"/>
						<DataGridTextColumn Header="Price" Binding="{Binding CurrentPrice, StringFormat='${0:F2}'}" Width="1*"/>
						<DataGridTextColumn Header="Unit" Binding="{Binding Unit}" Width="1*"/>
						<DataGridTextColumn Header="Vendor" Binding="{Binding VendorName}" Width="1.5*"/>
						<DataGridTextColumn Header="SKU" Binding="{Binding VendorSku}" Width="1*"/>
						<DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="1*"/>
					</DataGrid.Columns>
				</DataGrid>
			</Grid>
		</Border>

		<!-- Action Buttons -->
		<Border Grid.Row="2" Margin="0,20,0,0">
			<Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="12">
				<TextBlock Grid.Column="0"
				          Text="{Binding ImportSummary}"
				          VerticalAlignment="Center"
				          Foreground="#666"
				          FontSize="13"/>
				<Button Grid.Column="1"
				       Content="Cancel"
				       Command="{Binding CancelCommand}"
				       Padding="28,11"
				       MinWidth="110"/>
				<Button Grid.Column="2"
				       Content="Import"
				       Command="{Binding ImportCommand}"
				       IsEnabled="{Binding CanImport}"
				       Padding="28,11"
				       MinWidth="130"
				       Classes="primary"/>
			</Grid>
		</Border>
	</Grid>
</Window>
